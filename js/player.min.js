/*
	Project: blinkx/Tizen HTML5 Video Player
	This open source project was created by blinkx for the Tizen community. It is released under the ??? license.
	Website: www.blinkx.com
	@author Jasper Valero
*/$(function(){"use strict";$.fn.filterNode=function(e){return this.find("*").filter(function(){return this.nodeName===e})};var e={playerDiv:$(".blinkx-player"),playlistURL:"data/playlist-mrss.xml",dataType:"mrss",playerWidth:"320",playerHeight:"180",controlsEnabled:!0,autoplayEnabled:!1,autoplayNext:!1,player:null,playlist:null,numPlaylistItems:null,currentPosition:null,init:function(){var e=this;this.playerDiv.html(function(){var t='<video width="'+e.playerWidth+'" height="'+e.playerHeight+'" ';e.controlsEnabled&&(t+="controls ");e.autoplayEnabled&&(t+='autoplay="autoplay" ');t+="></video>";return t});this.player=this.playerDiv.children("video");this.fetchPlaylist();this.player.bind("click",function(){this.play();e.player.unbind("click")});this.playerDiv.siblings(".test").find(".prev").bind("click",function(){console.log("Prev");e.loadPreviousVideo()});this.playerDiv.siblings(".test").find(".next").bind("click",function(){console.log("Next");e.loadNextVideo()});this.autoplayNext&&this.player.bind("ended",function(){console.log("Video ended.");e.loadNextVideo()});this.player.touchSwipeLeft(this.onSwipeLeft);this.player.touchSwipeRight(this.onSwipeRight)},fetchPlaylist:function(){var e=this;$.ajax({url:this.playlistURL}).done(function(t){var n=e.getNumPlaylistItems(t);e.dataType.toLowerCase()==="json"?e.playlist=t:e.dataType.toLowerCase()==="xml"?e.playlist=e.xmlToJson(t):e.dataType.toLowerCase()==="mrss"&&(e.playlist=e.mrssToJson(t));e.loadFirstVideo();console.log(""+n+" playlist items fetched successfully!")}).fail(function(){console.error("There was a problem fetching the playlist. Please double check the playlistURL and dataType and try again.")}).always(function(){})},getNumPlaylistItems:function(e){if(this.dataType.toLowerCase()==="json"){this.numPlaylistItems=e.tracks.length;return e.tracks.length}if(this.dataType.toLowerCase()==="xml"){this.numPlaylistItems=$(e).find("track").length;return $(e).find("track").length}if(this.dataType.toLowerCase()==="mrss"){this.numPlaylistItems=$(e).find("item").length;return $(e).find("item").length}},loadFirstVideo:function(){var e=this;this.currentPosition=0;this.player.prop({src:e.playlist.tracks[0].file,poster:e.playlist.tracks[0].image})},loadNextVideo:function(){var e=this;console.log(this);this.currentPosition=this.currentPosition+1;this.currentPosition>this.numPlaylistItems-1&&(this.currentPosition=0);this.player.prop({src:e.playlist.tracks[this.currentPosition].file,poster:e.playlist.tracks[this.currentPosition].image})},loadPreviousVideo:function(){var e=this;this.currentPosition--;this.currentPosition<0&&(this.currentPosition=this.numPlaylistItems-1);this.player.prop({src:e.playlist.tracks[this.currentPosition].file,poster:e.playlist.tracks[this.currentPosition].image})},onSwipeLeft:function(){e.loadNextVideo();console.log("Swipe Left - Load Next Video")},onSwipeRight:function(){e.loadPreviousVideo();console.log("Swipe Right - Load Previous Video")},mrssToJson:function(e){var t={tracks:[]};for(var n=0;n<this.numPlaylistItems;n++){var r=$(e).filterNode("item")[n],i=$(r).filterNode("media:content").attr("url"),s=$(r).filterNode("media:title").text(),o=$(r).filterNode("media:thumbnail").attr("url");t.tracks[n]={file:i,title:s,image:o}}return t},xmlToJson:function(e){var t={tracks:[]};for(var n=0;n<this.numPlaylistItems;n++){var r=$(e).filterNode("track")[n],i=$(r).filterNode("file").text(),s=$(r).filterNode("title").text(),o=$(r).filterNode("image").text(),u=$(r).filterNode("thumb").text();t.tracks[n]={file:i,title:s,image:o,thumb:u}}return t}};e.init()});