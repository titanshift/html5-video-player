/*
	Project: blinkx/Tizen HTML5 Video Player
	This open source project was created by blinkx for the Tizen community. It is released under the ??? license.
	Website: www.blinkx.com
	@author Jasper Valero
*/$(function(){"use strict";$.fn.filterNode=function(e){return this.find("*").filter(function(){return this.nodeName===e})};var e={playerDiv:$(".blinkx-player"),playlistURL:"data/playlist-mrss.xml",dataType:"mrss",playerWidth:320,playerHeight:180,controlsEnabled:!0,autoplayEnabled:!1,autoplayNext:!1,horizontalSwipeEnabled:!0,thumbnailLayout:"bottom",thumbnailMargin:5,thumbnailWidthOffset:0,thumbnailHeightOffset:0,thumbsDiv:null,init:function(){var e=this;if(this.thumbnailLayout!=="none"){this.calculateAspectRatio(this.playerWidth,this.playerHeight);if(this.thumbnailLayout==="top"||this.thumbnailLayout==="bottom"){this.getHorizontalThumbWidth();this.getHorizontalThumbHeight();this.thumbnailHeightOffset=this.thumbnailHeight;console.log("DIMS: "+this.thumbnailWidth+" x "+this.thumbnailHeight)}else if(this.thumbnailLayout==="left"||this.thumbnailLayout==="right"){this.getVerticalThumbHeight();this.getVerticalThumbWidth();this.thumbnailWidthOffset=this.thumbnailWidth+3;console.log("DIMS: "+this.thumbnailWidth+" x "+this.thumbnailHeight)}}this.playerDiv.html(function(){var t='<video width="'+e.playerWidth+'" height="'+e.playerHeight+'" ';e.controlsEnabled&&(t+="controls ");e.autoplayEnabled&&(t+='autoplay="autoplay" ');t+="></video>";return t}).css({width:e.playerWidth+e.thumbnailWidthOffset,height:e.playerHeight+e.thumbnailHeightOffset});this.player=this.playerDiv.children("video");this.fetchPlaylist();switch(this.thumbnailLayout){case"top":this.playerDiv.prepend('<div class="thumbs thumbs-top"></div>');break;case"bottom":this.playerDiv.append('<div class="thumbs thumbs-bottom"></div>');break;case"left":this.playerDiv.prepend('<div class="thumbs thumbs-left"></div>');break;case"right":this.playerDiv.append('<div class="thumbs thumbs-right"></div>');break;case"none":}this.player.bind("click",function(){this.play();e.player.unbind("click")});this.playerDiv.siblings(".test").find(".prev").bind("click",function(){console.log("Prev");e.loadPreviousVideo()});this.playerDiv.siblings(".test").find(".next").bind("click",function(){console.log("Next");e.loadNextVideo()});this.autoplayNext&&this.player.bind("ended",function(){console.log("Video ended.");e.loadNextVideo()});if(this.horizontalSwipeEnabled){this.player.touchSwipeLeft(this.onSwipeLeft);this.player.touchSwipeRight(this.onSwipeRight)}},addThumbs:function(){var e=this,t="";this.thumbsDiv=this.playerDiv.children(".thumbs");t="<ul>";for(var n=0;n<this.numPlaylistItems;n++)t+='<li><img src="'+this.playlist.tracks[n].image+'" alt="'+this.playlist.tracks[n].title+'" width="'+this.thumbnailWidth+'" height="'+this.thumbnailHeight+' "></li>';t+="</ul>";this.thumbsDiv.html(t);this.thumbsDiv.find("ul li").css({height:this.thumbnailHeight});this.thumbsDiv.find("ul li img").filter(":first").addClass("active");this.thumbsDiv.find("ul li img").each(function(t){$(this).bind("click",{index:t},function(t){var n=$(this),r=t.data.index;$(".active").removeClass("active");n.addClass("active");e.player.prop({poster:e.playlist.tracks[r].image,src:e.playlist.tracks[r].file})})})},fetchPlaylist:function(){var e=this;$.ajax({url:this.playlistURL}).done(function(t){var n=e.getNumPlaylistItems(t);e.dataType.toLowerCase()==="json"?e.playlist=t:e.dataType.toLowerCase()==="xml"?e.playlist=e.xmlToJson(t):e.dataType.toLowerCase()==="mrss"&&(e.playlist=e.mrssToJson(t));e.loadFirstVideo();this.thumbnailLayout!=="none"&&e.addThumbs();console.log(""+n+" playlist items fetched successfully!")}).fail(function(){console.error("There was a problem fetching the playlist. Please double check the playlistURL and dataType and try again.")}).always(function(){})},getHorizontalThumbWidth:function(){this.thumbnailWidth=(this.playerWidth-this.thumbnailMargin*4)/5},getHorizontalThumbHeight:function(){this.thumbnailHeight=this.thumbnailWidth/this.thumbnailAspectRatio},getNumPlaylistItems:function(e){if(this.dataType.toLowerCase()==="json"){this.numPlaylistItems=e.tracks.length;return e.tracks.length}if(this.dataType.toLowerCase()==="xml"){this.numPlaylistItems=$(e).find("track").length;return $(e).find("track").length}if(this.dataType.toLowerCase()==="mrss"){this.numPlaylistItems=$(e).find("item").length;return $(e).find("item").length}},getVerticalThumbWidth:function(){this.thumbnailWidth=this.thumbnailHeight*this.thumbnailAspectRatio},getVerticalThumbHeight:function(){this.thumbnailHeight=(this.playerHeight-this.thumbnailMargin*4)/5},calculateAspectRatio:function(e,t){this.thumbnailAspectRatio=e/t},loadFirstVideo:function(){var e=this;this.currentPosition=0;this.player.prop({src:e.playlist.tracks[0].file,poster:e.playlist.tracks[0].image})},loadNextVideo:function(){var e=this;console.log(this);this.currentPosition=this.currentPosition+1;this.currentPosition>this.numPlaylistItems-1&&(this.currentPosition=0);this.player.prop({src:e.playlist.tracks[this.currentPosition].file,poster:e.playlist.tracks[this.currentPosition].image})},loadPreviousVideo:function(){var e=this;this.currentPosition--;this.currentPosition<0&&(this.currentPosition=this.numPlaylistItems-1);this.player.prop({src:e.playlist.tracks[this.currentPosition].file,poster:e.playlist.tracks[this.currentPosition].image})},onSwipeLeft:function(){e.loadNextVideo();console.log("Swipe Left - Load Next Video")},onSwipeRight:function(){e.loadPreviousVideo();console.log("Swipe Right - Load Previous Video")},mrssToJson:function(e){var t={tracks:[]};for(var n=0;n<this.numPlaylistItems;n++){var r=$(e).filterNode("item")[n],i=$(r).filterNode("media:content").attr("url"),s=$(r).filterNode("media:title").text(),o=$(r).filterNode("media:thumbnail").attr("url");t.tracks[n]={file:i,title:s,image:o}}return t},xmlToJson:function(e){var t={tracks:[]};for(var n=0;n<this.numPlaylistItems;n++){var r=$(e).filterNode("track")[n],i=$(r).filterNode("file").text(),s=$(r).filterNode("title").text(),o=$(r).filterNode("image").text(),u=$(r).filterNode("thumb").text();t.tracks[n]={file:i,title:s,image:o,thumb:u}}return t}};e.init()});